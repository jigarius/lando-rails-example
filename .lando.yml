name: lando-rails-example
proxy:
  appserver:
    - rails.lndo.site:3000
services:
  appserver:
    type: compose
    services:
      image: ruby:2.7.2
      command: /app/lando/appserver/server.sh
      ports:
        - '3000'
      environment:
        DATABASE_USER: postgres
        DATABASE_PASS: ''
        RAILS_ENV: development
    build_as_root:
      - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
      - echo "deb https://dl.yarnpkg.com/debian/ stable main" >> /etc/apt/sources.list.d/yarn.list
      - apt -qq update
      - apt -qq install -y nodejs yarn postgresql-client
      - chmod +x /app/lando/appserver/server.sh
    build:
      - bundle install --gemfile=/app/Gemfile
  database:
    type: postgres:12
    portforward: true
    creds:
      database: ror_development
      user: postgres
      password: NO PASSWORD
tooling:
  rails:
    service: appserver
    cmd: bundle exec rails
  bundle:
    service: appserver
  rake:
    service: appserver
  yarn:
    service: appserver
  irb:
    service: appserver
  ruby:
    service: appserver
